// Prisma Schema for StoreMom
// Compatible with existing database structure

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model Customer {
  id        Int      @id @default(autoincrement())
  fname     String   @db.VarChar(45)
  lname     String   @db.VarChar(45)
  phone     String?  @db.VarChar(20)
  email     String?  @db.VarChar(100)
  address   String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  orders    Order[]

  @@index([fname, lname])
  @@map("customer")
}

model Product {
  productId       Int      @id @default(autoincrement())
  productName     String   @db.VarChar(100)
  quantityInStock Int      @default(0)
  price           Decimal  @db.Decimal(10, 2)
  volume          String?  @db.VarChar(45)
  description     String?  @db.Text
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  orderDetails    OrderDetail[]

  @@index([productName])
  @@map("product")
}

model Order {
  orderId     Int      @id @default(autoincrement())
  customerId  Int      @map("customer_id")
  totalAmount Decimal  @default(0) @db.Decimal(10, 2)
  profit      Decimal  @default(0) @db.Decimal(10, 2)
  orderDate   DateTime @default(now())
  status      String   @default("pending") @db.VarChar(20)
  note        String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  customer     Customer @relation(fields: [customerId], references: [id], onDelete: Restrict)
  orderDetails OrderDetail[]

  @@index([orderDate])
  @@index([customerId])
  @@map("orders")
}

model OrderDetail {
  orderDetailId   Int      @id @default(autoincrement())
  orderId         Int
  productId       Int
  quantityOrdered Int
  priceEach       Decimal  @db.Decimal(10, 2)
  createdAt       DateTime @default(now()) @map("created_at")
  
  order   Order   @relation(fields: [orderId], references: [orderId], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [productId], onDelete: Restrict)

  @@index([orderId])
  @@index([productId])
  @@map("orderdetail")
}

